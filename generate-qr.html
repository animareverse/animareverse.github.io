<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generatore Codice QR - Assegnazione Tavoli Matrimonio</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="wedding-title">Generatore Codice QR</h1>
        <p class="wedding-subtitle">
          Genera un codice QR per il sistema di assegnazione tavoli del matrimonio
        </p>
        <div class="heart-decoration">ðŸŒ³</div>
      </div>

      <div class="qr-generator">
        <div class="form-group">
          <label for="websiteUrl">URL del Sito Web</label>
          <input type="url" id="websiteUrl" placeholder="https://tuosito.com/index.html" value="" />
          <small class="form-help"
            >Inserisci l'URL completo dove ospiterai il sistema di assegnazione tavoli</small
          >
        </div>

        <button id="generateBtn" onclick="generateQR()" class="submit-btn">Genera Codice QR</button>

        <div id="qrResult" class="qr-result" style="display: none">
          <h3>Il Tuo Codice QR:</h3>
          <div id="qrcode"></div>
          <p class="qr-instructions">
            <strong>Istruzioni:</strong><br />
            1. Clicca con il tasto destro sul codice QR e salva l'immagine<br />
            2. Stampalo su un bel cartoncino o poster<br />
            3. Posizionalo all'ingresso del locale del matrimonio<br />
            4. Gli ospiti possono scansionarlo con le fotocamere dei loro telefoni per trovare i
            loro tavoli!
          </p>
          <button onclick="downloadQR()" class="back-btn">Scarica Codice QR</button>
        </div>
      </div>

      <div class="setup-instructions">
        <h3>Istruzioni di Configurazione:</h3>
        <ol>
          <li>
            <strong>Modifica Lista Ospiti:</strong> Apri <code>guests.js</code> e sostituisci i dati
            di esempio con la tua lista ospiti reale
          </li>
          <li>
            <strong>Ospita il Sito Web:</strong> Carica tutti i file su un servizio di hosting web
            (GitHub Pages, Netlify, Vercel, ecc.)
          </li>
          <li>
            <strong>Genera Codice QR:</strong> Inserisci l'URL del tuo sito web sopra e genera il
            codice QR
          </li>
          <li>
            <strong>Stampa e Esponi:</strong> Stampa il codice QR e posizionalo all'ingresso del
            locale
          </li>
        </ol>
      </div>

      <div class="footer">
        <p>Perfetto per un matrimonio nella foresta incantata! ðŸŒ²âœ¨</p>
      </div>
    </div>

    <script>
      // Set default URL if running locally
      document.addEventListener('DOMContentLoaded', function () {
        const urlInput = document.getElementById('websiteUrl')
        if (window.location.protocol === 'file:') {
          urlInput.value = window.location.href.replace('generate-qr.html', 'index.html')
        }
      })

      let qrCanvas = null

      function generateQR() {
        const url = document.getElementById('websiteUrl').value
        if (!url) {
          alert('Per favore inserisci un URL del sito web')
          return
        }

        // Show loading state
        const generateBtn = document.getElementById('generateBtn')
        const originalText = generateBtn.textContent
        generateBtn.innerHTML = '<span class="loading"></span> Generazione...'
        generateBtn.disabled = true

        const qrContainer = document.getElementById('qrcode')
        qrContainer.innerHTML = ''

        try {
          // Use QR Server API - reliable and simple
          const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(
            url
          )}&color=2e7d32&bgcolor=ffffff&margin=10`

          const img = document.createElement('img')
          img.src = qrUrl
          img.alt = 'Codice QR per il matrimonio'
          img.className = 'qr-code-image'
          img.style.borderRadius = '10px'
          img.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.2)'
          img.style.maxWidth = '100%'
          img.style.height = 'auto'

          img.onload = function () {
            // Reset button
            generateBtn.textContent = originalText
            generateBtn.disabled = false

            qrContainer.appendChild(img)
            qrCanvas = img // Store for download
            document.getElementById('qrResult').style.display = 'block'
          }

          img.onerror = function () {
            // Reset button
            generateBtn.textContent = originalText
            generateBtn.disabled = false
            alert('Errore nella generazione del codice QR. Verifica la connessione internet.')
          }
        } catch (error) {
          // Reset button
          generateBtn.textContent = originalText
          generateBtn.disabled = false
          console.error('Error generating QR code:', error)
          alert('Errore nella generazione del codice QR. Riprova.')
        }
      }

      function downloadQR() {
        if (!qrCanvas) {
          alert('Per favore genera prima un codice QR')
          return
        }

        // For image-based QR codes, we'll download the image directly
        const link = document.createElement('a')
        link.download = 'matrimonio-mariam-ismail-qr-code.png'
        link.href = qrCanvas.src
        link.target = '_blank'
        document.body.appendChild(link)
        link.click()
        document.body.removeChild(link)
      }
    </script>

    <style>
      .qr-generator {
        background: rgba(255, 255, 255, 0.9);
        padding: 40px 30px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 40px;
      }

      .qr-result {
        text-align: center;
        margin-top: 30px;
        padding-top: 30px;
        border-top: 1px solid #eee;
      }

      .qr-result h3 {
        margin-bottom: 20px;
        color: #2e7d32;
      }

      .qr-result canvas {
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .qr-instructions {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: left;
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .setup-instructions {
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .setup-instructions h3 {
        color: #2e7d32;
        margin-bottom: 20px;
        font-family: 'Dancing Script', cursive;
        font-size: 1.8rem;
      }

      .setup-instructions ol {
        text-align: left;
        line-height: 1.8;
      }

      .setup-instructions li {
        margin-bottom: 10px;
      }

      .setup-instructions code {
        background: #f1f3f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
      }
    </style>
  </body>
</html>
